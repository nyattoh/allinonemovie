# main_workflow.yaml
nodes:
  # ─── START ───
  START:
    next: ASK_Q

  # ─── 1. 初期ヒアリング ───
  ASK_Q:
    func: ask_initial_questions
    branch: info_sufficient

  ASK_Q_DETAIL:
    func: ask_additional_questions
    next: ASK_Q

  # ─── 2. 草案プロトタイプ生成 ───
  PROTOTYPE:
    func: prototype_generation
    next: REVIEW

  # ─── 3. 草案レビュー ───
  REVIEW:
    func: review_drafts
    branch: review_result

  # ─── 4. 次の行き先を選択 ───
  NEXT_STEP:
    branch: next_choice

  # ─── 映像化フロー ───
  VIDEO_FLOW:
    func: video_flow_start
    next: END

  # ─── 他の工程へ ───
  OTHER_FLOW:
    func: other_flow
    next: PROCESS1    # 続けるなら PROCESS1 へ、あるいは別ノードに

  # ─── 既存の 1～23 プロセス ───
  PROCESS1:
    func: process_1
    next: PROCESS2
  PROCESS2:
    func: process_2
    next: PROCESS3
  PROCESS3:
    func: process_3
    next: PROCESS4
  PROCESS4:
    func: process_4
    next: PROCESS5
  PROCESS5:
    func: process_5
    next: PROCESS6
  PROCESS6:
    func: process_6
    next: PROCESS7
  PROCESS7:
    func: process_7
    next: PROCESS8
  PROCESS8:
    func: process_8
    next: PROCESS9
  PROCESS9:
    func: process_9
    next: PROCESS10
  PROCESS10:
    func: process_10
    next: PROCESS11
  PROCESS11:
    func: process_11
    next: PROCESS12
  PROCESS12:
    func: process_12
    next: PROCESS13
  PROCESS13:
    func: process_13
    next: PROCESS14
  PROCESS14:
    func: process_14
    next: PROCESS15
  PROCESS15:
    func: process_15
    next: PROCESS16
  PROCESS16:
    func: process_16
    next: PROCESS17
  PROCESS17:
    func: process_17
    next: PROCESS18
  PROCESS18:
    func: process_18
    next: PROCESS19
  PROCESS19:
    func: process_19
    next: PROCESS20
  PROCESS20:
    func: process_20
    next: PROCESS21
  PROCESS21:
    func: process_21
    next: PROCESS22
  PROCESS22:
    func: process_22
    next: PROCESS23
  PROCESS23:
    func: process_23
    next: PROCESS23_END

  # ─── フェルミ推定・書き直しループ ───
  PROCESS23_END:
    func: fermi_evaluate
    branch: rewrite_needed
  FEEDBACK:
    func: feedback_analysis
    next: REWRITE
  REWRITE:
    func: rewrite_cycle
    next: PROCESS23_END
    loop_max: 15

  # ─── 最終終了 ───
  END: {}

branches:
  # ヒアリング完了の分岐
  info_sufficient:
    yes: PROTOTYPE
    no:  ASK_Q_DETAIL

  # 草案レビューの分岐
  review_result:
    ok:   NEXT_STEP
    redo: PROTOTYPE

  # NEXT_STEP での行き先選択
  next_choice:
    video: VIDEO_FLOW
    other: OTHER_FLOW
    continue: PROCESS1

  # 書き直しループの分岐
  rewrite_needed:
    lt90: FEEDBACK
    gte90: END
